<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd" >
<sqlMap namespace="nike_space">
	<typeAlias  alias="egovMap"  type="egovframework.rte.psl.dataaccess.util.EgovMap"/>
	<typeAlias  alias="nikeVO" type="egov.service.NikeVO"/>
	
	<select id="nikeDAO.selectHitGoodsList" resultClass="egovMap">
	
		SELECT b.* FROM  (	
			SELECT 
				rownum rn, a.* 
			FROM  (
			
				SELECT 
					unq,
					category,
					ctgtype,
					ctggender,
					price,
					csize,
					color,
					thumbnail,
                    hits,
					substr(name,0,20) name
				FROM 
					goodsinfo	
				ORDER BY 
					hits DESC	
								
			) a
		) b
		
		
		WHERE rn >= 1  AND rn <![CDATA[<=]]> 6

	</select>
	
	<select id="nikeDAO.selectGoodsTotal" resultClass="java.lang.Integer">

		SELECT 
			COUNT(*)
		FROM 
			goodsinfo
			
		<isNotNull property="sql">
			<isNotEmpty property="sql">
				WHERE ( 1=1 ) $sql$
			</isNotEmpty>
		</isNotNull>	
		


	</select>
	
	<select id="nikeDAO.selectGoodsList" resultClass="egovMap">
	
		SELECT b.* FROM  (	
			SELECT 
				rownum rn, a.* 
			FROM  (
			
				SELECT 
					unq,
					category,
					ctgtype,
					ctggender,
					price,
					csize,
					color,
					thumbnail,
					substr(name,0,20) name
				FROM 
					goodsinfo
				<isNotNull property="sql">
			     	<isNotEmpty property="sql">
						WHERE ( 1=1 ) $sql$
				   	</isNotEmpty>
				</isNotNull>
				ORDER BY 
					unq DESC	
								
			) a
		) b
		
		WHERE rn >= #s_no#  AND rn <![CDATA[<=]]> #e_no#

	</select>
	
	<select id="nikeDAO.selectGoodsDetail" resultClass="nikeVO">
		SELECT
				unq,
				category,
				ctgtype,
				ctggender,
				price,
				csize,
				color,
				thumbnail,
				goodsimg,
				hits,
				name
		FROM
				goodsinfo
		WHERE
				unq=#unq#
	</select>

	<select id="nikeDAO.selectTab1" resultClass="nikeVO">
		SELECT
				unq,
				goodsimg
		FROM
				goodsinfo
		WHERE
				unq=#unq#
	</select>
	
	
   <select id="nikeDAO.selectIdCheck" resultClass="java.lang.Integer">
		SELECT COUNT(*) FROM  userinfo WHERE userid=#userid#
	
	
	</select>
	
  <select id="nikeDAO.selectMemberCertify" resultClass="java.lang.Integer">
		SELECT COUNT(*) 
				FROM userinfo 
				WHERE 
					userid=#userid# AND pass=#pass#
	</select>
	
  <select id="nikeDAO.selectMemberDetail" resultClass="nikeVO">
		SELECT  userid,
			    pass,
			    name,
			    birth,
			    phone,
			    email,
			    zipcode,
			    address1,
			    address2,
			    rdate,
			    udate
		   FROM 
		        userinfo 
		  WHERE 
		        userid=#userid#
	
	</select>
	
	<select id="nikeDAO.selectCartList" resultClass="egovMap">
		SELECT 	c.unq,
				c.userid userid,
		        c.goodsunq goodsunq,
		        c.qty qty,
		        nvl(substr(g.thumbnail,0,instr(g.thumbnail,'/')-1),g.thumbnail) thumbnail,
		        g.name name,
		        c.color color,
		        c.csize csize,
		        g.price price
		    FROM 
		    	cart c, goodsinfo g
		    WHERE 
		    	c.goodsunq=g.unq
		    <!-- session 추가한 뒤 -->
		    <!-- and userid=#userid# -->
	</select>
	
	<select id="nikeDAO.selectCartListCnt" resultClass="java.lang.Integer">
		SELECT count(*) FROM cart WHERE userid=#userid#
	</select>
	
	<select id="nikeDAO.selectCheckout" resultClass="egovMap">
		SELECT 	c.unq,
				c.userid userid,
		        c.goodsunq goodsunq,
		        c.qty qty,
		        g.name name,
		        c.color color,
		        c.csize csize,
		        g.price price
		    FROM 
		    	cart c, goodsinfo g
		    WHERE 
		    	c.goodsunq=g.unq
	</select>

	<insert id="nikeDAO.insertJoin">
		INSERT INTO userinfo(
				    userid,
				    pass,
				    name,
				    birth,
				    phone,
				    email,
				    zipcode,
				    address1,
				    address2,
				    rdate,
				    udate
				) VALUES (
				    #userid#,
				    #pass#,
				    #name#,
				    #birth#,
				    #phone#,
				    #email#,
				    #zipcode#,
				    #address1#,
				    #address2#,
				    sysdate,
				    sysdate
				)
	</insert>
	
	<update id="nikeDAO.updateMember">
		UPDATE userinfo set 
						    name=#name#,
						    birth=#birth#,
						    phone=#phone#,
						    email=#email#,
						    zipcode=#zipcode#,
						    address1=#address1#,
						    address2=#address2#,						    
						    udate=sysdate
						WHERE userid=#userid#
	
	</update>
	
	
	<update id="nikeDAO.updateGoodsInfoHits">
		UPDATE 
				goodsinfo
		SET
				hits=hits+1
		WHERE
				unq=#unq#
	</update>
	
	<update id="nikeDAO.updateCartList">
		UPDATE
				cart
		SET
				qty=#qty#
		WHERE
			 	unq=#unq#
	</update>
	
	<delete id="nikeDAO.deleteCartList">
		DELETE FROM cart WHERE unq=#unq#
	</delete>
	
	<delete id="nikeDAO.deleteAllCartList">
		DELETE FROM cart WHERE userid=#userid#
	</delete>
	
	
</sqlMap>